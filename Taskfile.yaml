version: '3'

vars:
  PY: "{{.PYTHON | default `python`}}"
  GIT_REMOTE: "git@github.com:nicholasgrose/project_template.git"

tasks:
  bootstrap:
    desc: Bootstrap the repository
    deps:
      - git:bootstrap
      - docs:bootstrap
      - cli:bootstrap

  git:bootstrap:
    desc: Bootstrap git repo
    status:
      - git status
    cmds:
      - git init
      - git add -A
      - git commit -m "Initial commit"
      - git branch -M main
      - "git remote add origin {.GIT_REMOTE}"
      - git push -u origin main

  docs:bootstrap:
    desc: Create/update MkDocs virtualenv and install deps
    status:
      - test -d docs/.venv
    cmd: "{{.PY}} -m scripts.docs.mkdocs_bootstrap"

  docs:serve:
    desc: Serve docs locally with live reload
    deps: [ docs:bootstrap ]
    cmd: "{{.PY}} -m scripts.docs.mkdocs serve"

  cli:bootstrap:
    desc: Bootstrap CLI dependencies
    status:
      - test -d generation_cli/.venv
    cmd: "{{.PY}} -m scripts.generation_cli.bootstrap_venv"

  cli:new:
    desc: Create a new repository from this project template
    deps: [ cli:bootstrap ]
    cmd: "{{.PY}} -m generation_cli.new_repo"

  cli:add:
    desc: Adds this template to an existing repository
    deps: [ cli:bootstrap ]
    cmd: "{{.PY}} -m generation_cli.existing_repo"
